<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üê≤ CNY Card Game üßß</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #8B0000 0%, #D4AF37 50%, #8B0000 100%);
      min-height: 100vh;
      color: white;
      padding: 15px;
    }
    .container { max-width: 900px; margin: 0 auto; animation: fadeIn 0.5s ease-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Screen transitions */
    .screen { display: none; }
    .screen.active { display: block; }
    
    /* Welcome Screen */
    .welcome-screen {
      text-align: center;
      padding: 40px 20px;
    }
    .welcome-screen h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
    }
    .welcome-screen .subtitle {
      font-size: 1.2rem;
      color: #FFD700;
      margin-bottom: 40px;
    }
    .game-selection {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      max-width: 600px;
      margin: 0 auto 40px;
    }
    .game-card {
      background: rgba(0,0,0,0.4);
      border: 3px solid #D4AF37;
      border-radius: 16px;
      padding: 25px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .game-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      border-color: #FFD700;
    }
    .game-card.selected {
      border-color: #00d9ff;
      background: rgba(0,217,255,0.2);
    }
    .game-card .icon { font-size: 3rem; margin-bottom: 10px; }
    .game-card .name { font-size: 1.3rem; font-weight: bold; color: #FFD700; }
    .game-card .desc { font-size: 0.85rem; color: #ccc; margin-top: 8px; }
    .game-card .coming-soon { 
      font-size: 0.75rem; 
      color: #ef4444; 
      margin-top: 10px;
      background: rgba(239,68,68,0.2);
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
    }
    
    .name-input-section {
      background: rgba(0,0,0,0.5);
      padding: 25px;
      border-radius: 12px;
      max-width: 400px;
      margin: 0 auto;
    }
    .name-input-section input {
      padding: 14px 18px;
      border-radius: 8px;
      border: 2px solid #D4AF37;
      font-size: 1.1rem;
      width: 100%;
      margin-bottom: 15px;
      background: rgba(255,255,255,0.95);
    }
    .name-input-section button {
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      background: #00d9ff;
      color: #000;
      transition: transform 0.1s;
    }
    .name-input-section button:hover { transform: scale(1.02); }
    .name-input-section button:disabled { background: #666; cursor: not-allowed; }

    /* Fortune badge */
    .fortune {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #8B0000, #DC2626);
      border-radius: 25px;
      border: 2px solid #FFD700;
      color: #FFD700;
      font-size: 0.9rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
      z-index: 100;
      animation: fortunePulse 3s ease-in-out infinite;
    }
    @keyframes fortunePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.03); }
    }
    header { text-align: center; margin-bottom: 20px; }
    h1 { font-size: 1.8rem; margin-bottom: 15px; }
    
    /* Game Screen */
    .game-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.4);
      padding: 12px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .game-info .game-name { font-size: 1.2rem; color: #FFD700; font-weight: bold; }
    .game-info .player-info { display: flex; align-items: center; gap: 15px; }
    .game-info .player-info .balance { color: #22c55e; font-weight: bold; }
    .game-info .back-btn {
      background: #6b7280;
      color: white;
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
    
    .table {
      background: #8B0000; border-color: #D4AF37;
      border-radius: 20px;
      padding: 30px;
      margin: 20px 0;
      border: 12px solid #854d0e;
      box-shadow: inset 0 0 40px rgba(0,0,0,0.4), 0 15px 40px rgba(0,0,0,0.5);
      min-height: 300px;
      position: relative;
    }
    
    /* Blackjack specific styles */
    .dealer-area {
      text-align: center;
      margin-bottom: 30px;
    }
    .dealer-area .label {
      font-size: 0.9rem;
      color: #FFD700;
      margin-bottom: 10px;
    }
    .dealer-area .score {
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
      margin-top: 10px;
    }
    .dealer-area .score.winner { color: #22c55e; }
    .dealer-area .score.loser { color: #ef4444; }
    
    .player-area {
      text-align: center;
    }
    .player-area .label {
      font-size: 0.9rem;
      color: #00d9ff;
      margin-bottom: 10px;
    }
    .player-area .score {
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
      margin-top: 10px;
    }
    .player-area .score.winner { color: #22c55e; }
    .player-area .score.loser { color: #ef4444; }
    
    .cards-row {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      min-height: 90px;
      align-items: center;
    }
    
    .card {
      width: 70px;
      height: 100px;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.4rem;
      box-shadow: 3px 3px 10px rgba(0,0,0,0.5);
      transition: transform 0.2s, box-shadow 0.2s;
      animation: slideUp 0.3s ease-out;
    }
    .card:hover {
      transform: translateY(-10px) scale(1.05);
      box-shadow: 5px 15px 20px rgba(0,0,0,0.5);
      z-index: 10;
    }
    .card.red { color: #dc2626; }
    .card.black { color: #1f2937; }
    .card.back {
      background: linear-gradient(135deg, #7c3aed 0%, #a855f7 50%, #7c3aed 100%);
      border: 3px solid #e9d5ff;
    }
    .card .suit { font-size: 1.8rem; line-height: 1; }
    .card .value { font-size: 1.2rem; }
    
    .game-controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 25px;
    }
    .game-controls button {
      padding: 14px 30px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      transition: transform 0.1s, box-shadow 0.2s;
    }
    .game-controls button:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .game-controls button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .btn-hit { background: #22c55e; color: white; }
    .btn-stand { background: #ef4444; color: white; }
    .btn-double { background: #f59e0b; color: #000; }
    .btn-new-game { background: #00d9ff; color: #000; }
    
    .bet-section {
      text-align: center;
      margin: 20px 0;
    }
    .bet-section input {
      padding: 12px 20px;
      border-radius: 8px;
      border: 2px solid #D4AF37;
      font-size: 1.1rem;
      width: 120px;
      text-align: center;
      margin-right: 10px;
    }
    
    .game-message {
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 20px 0;
      padding: 15px;
      border-radius: 10px;
      animation: slideUp 0.3s ease-out;
    }
    .game-message.win { background: rgba(34,197,94,0.3); color: #22c55e; }
    .game-message.lose { background: rgba(239,68,68,0.3); color: #ef4444; }
    .game-message.push { background: rgba(255,255,255,0.2); color: #fff; }
    .game-message.blackjack { background: rgba(255,215,0,0.3); color: #FFD700; }
    
    /* Admin */
    .admin-panel {
      background: rgba(0,0,0,0.5);
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
    }
    .admin-panel input {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #D4AF37;
      background: rgba(255,255,255,0.9);
      width: 120px;
    }
    .admin-panel button {
      padding: 8px 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: #f59e0b;
      color: #000;
    }
    
    button {
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 500;
      transition: transform 0.1s, box-shadow 0.2s;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    button:active { transform: scale(0.96); }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="screen welcome-screen active">
      <h1>üê≤ Êñ∞Âπ¥Âø´‰πê üßß</h1>
      <p class="subtitle">Choose Your Game</p>
      
      <div class="game-selection">
        <div class="game-card selected" data-game="blackjack" onclick="selectGame('blackjack')">
          <div class="icon">üÉè</div>
          <div class="name">21ÁÇπ</div>
          <div class="desc">Classic Blackjack - Get closest to 21 without going over!</div>
        </div>
        <div class="game-card" data-game="poker" onclick="selectGame('poker')">
          <div class="icon">üÉè</div>
          <div class="name">Âæ∑Â∑ûÊâëÂÖã</div>
          <div class="desc">Texas Hold'em - Coming Soon</div>
          <div class="coming-soon">COMING SOON</div>
        </div>
      </div>
      
      <div class="name-input-section">
        <input type="text" id="playerName" placeholder="Enter your name" />
        <button id="playBtn" onclick="startGame()">üéÆ Play Now</button>
      </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="screen">
      <div class="game-info">
        <button class="back-btn" onclick="goBack()">‚Üê Back</button>
        <div class="game-name">üÉè 21ÁÇπ Blackjack</div>
        <div class="player-info">
          <span id="playerNameDisplay"></span>
          <span class="balance">üí∞ <span id="balanceDisplay">100</span></span>
        </div>
      </div>
      
      <div class="table">
        <!-- Dealer -->
        <div class="dealer-area">
          <div class="label">üé∞ Dealer</div>
          <div class="cards-row" id="dealerCards"></div>
          <div class="score" id="dealerScore"></div>
        </div>
        
        <!-- Message -->
        <div class="game-message" id="gameMessage" style="display:none;"></div>
        
        <!-- Player -->
        <div class="player-area">
          <div class="label">üë§ You</div>
          <div class="cards-row" id="playerCards"></div>
          <div class="score" id="playerScore"></div>
        </div>
        
        <!-- Betting (before game starts) -->
        <div class="bet-section" id="betSection">
          <input type="number" id="betAmount" placeholder="Bet" value="10" min="1" />
          <button class="btn-new-game" onclick="placeBet()">üí∞ Place Bet & Deal</button>
        </div>
        
        <!-- Game controls -->
        <div class="game-controls" id="gameControls" style="display:none;">
          <button class="btn-hit" id="hitBtn" onclick="hit()">üñêÔ∏è Hit</button>
          <button class="btn-stand" id="standBtn" onclick="stand()">‚úã Stand</button>
          <button class="btn-double" id="doubleBtn" onclick="doubleDown()">‚úåÔ∏è Double</button>
        </div>
        
        <!-- New game button -->
        <div class="game-controls" id="newGameControls" style="display:none;">
          <button class="btn-new-game" onclick="startNewGame()">üéÆ New Game</button>
        </div>
      </div>
      
      <!-- Admin Panel -->
      <div class="admin-panel" id="adminPanel">
        <span style="color:#FFD700;margin-right:10px;">üëë Admin:</span>
        <input type="password" id="adminPassword" placeholder="Password" />
        <button onclick="setAdmin()">Set</button>
        <button onclick="resetAll()">Reset All</button>
      </div>
    </div>
  </div>

  <!-- Fortune -->
  <div class="fortune" id="fortune">üßß ÊÅ≠ÂñúÂèëË¥¢ üßß</div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Fortune rotation
    const fortunes = ['üßß ÊÅ≠ÂñúÂèëË¥¢ üê≤','üê≤ Êñ∞Âπ¥Âø´‰πê üéä','üßß Ê≠•Ê≠•È´òÂçá üí∞','üéä ‰∏á‰∫ãÂ¶ÇÊÑè üßß','üßß Ë¥¢Ê∫êÂπøËøõ üéâ'];
    let fortuneIndex = 0;
    setInterval(() => {
      fortuneIndex = (fortuneIndex + 1) % fortunes.length;
      document.getElementById('fortune').textContent = fortunes[fortuneIndex];
    }, 4000);
    
    // =======================================================================
    // GAME STATE
    // =======================================================================
    let selectedGame = 'blackjack';
    let playerName = '';
    let balance = 100;
    let currentBet = 0;
    let gameState = 'betting'; // betting, playing, finished
    
    // =======================================================================
    // UI FUNCTIONS
    // =======================================================================
    function selectGame(game) {
      document.querySelectorAll('.game-card').forEach(card => {
        card.classList.remove('selected');
      });
      document.querySelector(`[data-game="${game}"]`).classList.add('selected');
      selectedGame = game;
    }
    
    function startGame() {
      const nameInput = document.getElementById('playerName');
      playerName = nameInput.value.trim();
      if (!playerName) {
        alert('Please enter your name');
        return;
      }
      
      // Switch to game screen
      document.getElementById('welcomeScreen').classList.remove('active');
      document.getElementById('gameScreen').classList.add('active');
      document.getElementById('playerNameDisplay').textContent = playerName;
      updateBalanceDisplay();
      
      // Connect to socket
      socket.emit('joinGame', { name: playerName, game: selectedGame });
    }
    
    function goBack() {
      if (confirm('Leave game? Your bet will be lost.')) {
        socket.emit('leaveGame');
        document.getElementById('gameScreen').classList.remove('active');
        document.getElementById('welcomeScreen').classList.add('active');
        resetGameUI();
      }
    }
    
    function updateBalanceDisplay() {
      document.getElementById('balanceDisplay').textContent = balance;
    }
    
    function resetGameUI() {
      balance = 100;
      currentBet = 0;
      gameState = 'betting';
      document.getElementById('betSection').style.display = 'block';
      document.getElementById('gameControls').style.display = 'none';
      document.getElementById('newGameControls').style.display = 'none';
      document.getElementById('gameMessage').style.display = 'none';
      document.getElementById('dealerCards').innerHTML = '';
      document.getElementById('playerCards').innerHTML = '';
      document.getElementById('dealerScore').textContent = '';
      document.getElementById('playerScore').textContent = '';
      updateBalanceDisplay();
    }
    
    // =======================================================================
    // GAME ACTIONS
    // =======================================================================
    function placeBet() {
      const betInput = document.getElementById('betAmount');
      const bet = parseInt(betInput.value);
      
      if (isNaN(bet) || bet < 1) {
        alert('Please enter a valid bet');
        return;
      }
      if (bet > balance) {
        alert('Insufficient balance');
        return;
      }
      
      currentBet = bet;
      balance -= bet;
      updateBalanceDisplay();
      
      socket.emit('placeBet', { bet: bet });
    }
    
    function hit() {
      socket.emit('hit');
    }
    
    function stand() {
      socket.emit('stand');
    }
    
    function doubleDown() {
      if (currentBet * 2 > balance) {
        alert('Insufficient balance for double');
        return;
      }
      balance -= currentBet;
      currentBet *= 2;
      updateBalanceDisplay();
      socket.emit('double');
    }
    
    function startNewGame() {
      resetGameUI();
    }
    
    // =======================================================================
    // SOCKET CONNECTION
    // =======================================================================
    const socket = io();
    
    socket.on('connect', () => {
      console.log('Connected to server');
    });
    
    socket.on('gameState', (state) => {
      renderGame(state);
    });
    
    socket.on('balanceUpdate', (newBalance) => {
      balance = newBalance;
      updateBalanceDisplay();
    });
    
    socket.on('error', (msg) => {
      alert(msg);
    });
    
    // =======================================================================
    // RENDER FUNCTIONS
    // =======================================================================
    function renderCard(card, hidden = false) {
      if (hidden) {
        return '<div class="card back"></div>';
      }
      const color = (card.suit === '‚ô•' || card.suit === '‚ô¶') ? 'red' : 'black';
      return `<div class="card ${color}">
        <div class="value">${card.value}</div>
        <div class="suit">${card.suit}</div>
      </div>`;
    }
    
    function renderGame(state) {
      // Render dealer cards
      const dealerHtml = state.dealerCards.map((card, i) => 
        renderCard(card, i === 0 && state.dealerHidden)
      ).join('');
      document.getElementById('dealerCards').innerHTML = dealerHtml;
      
      // Render player cards
      const playerHtml = state.playerCards.map(card => renderCard(card)).join('');
      document.getElementById('playerCards').innerHTML = playerHtml;
      
      // Scores
      if (state.gameOver) {
        document.getElementById('dealerScore').textContent = 'Score: ' + state.dealerScore;
        document.getElementById('playerScore').textContent = 'Score: ' + state.playerScore;
      } else {
        document.getElementById('dealerScore').textContent = state.dealerHidden ? '?' : 'Score: ' + state.dealerScore;
        document.getElementById('playerScore').textContent = 'Score: ' + state.playerScore;
      }
      
      // Game state
      if (state.gameOver) {
        gameState = 'finished';
        document.getElementById('betSection').style.display = 'none';
        document.getElementById('gameControls').style.display = 'none';
        document.getElementById('newGameControls').style.display = 'flex';
        
        // Show result message
        const msg = document.getElementById('gameMessage');
        msg.style.display = 'block';
        
        if (state.result === 'blackjack') {
          msg.className = 'game-message blackjack';
          msg.textContent = 'üéâ BLACKJACK! You win!';
        } else if (state.result === 'win') {
          msg.className = 'game-message win';
          msg.textContent = 'üéä You Win! +' + (currentBet * 2);
        } else if (state.result === 'lose') {
          msg.className = 'game-message lose';
          msg.textContent = 'üíÄ Dealer Wins!';
        } else if (state.result === 'push') {
          msg.className = 'game-message push';
          msg.textContent = '‚öñÔ∏è Push - Bet returned';
        }
      } else if (state.playerCards.length > 0) {
        gameState = 'playing';
        document.getElementById('betSection').style.display = 'none';
        document.getElementById('gameControls').style.display = 'flex';
        document.getElementById('newGameControls').style.display = 'none';
        document.getElementById('gameMessage').style.display = 'none';
        
        // Disable double if not enough balance
        document.getElementById('doubleBtn').disabled = (balance < currentBet);
      }
      
      // Check for blackjack on initial deal
      if (state.result === 'blackjack' && state.gameOver) {
        balance += currentBet * 2.5; // Blackjack pays 3:2
        currentBet = 0;
        updateBalanceDisplay();
      }
    }
    
    // =======================================================================
    // ADMIN
    // =======================================================================
    function setAdmin() {
      const password = document.getElementById('adminPassword').value;
      socket.emit('setAdmin', { password: password });
    }
    
    function resetAll() {
      if (confirm('Reset all players and balances?')) {
        socket.emit('adminReset');
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üê≤ CNY Card Games</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #8B0000 0%, #D4AF37 50%, #8B0000 100%);
      min-height: 100vh;
      color: white;
      padding: 15px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    
    /* Welcome Screen */
    #welcomeScreen { 
      display: block; 
      text-align: center; 
      padding: 60px 20px; 
    }
    #welcomeScreen h1 { 
      font-size: 3rem; 
      margin-bottom: 10px; 
    }
    #welcomeScreen .subtitle { 
      font-size: 1.3rem; 
      color: #ffd700; 
      margin-bottom: 40px; 
    }
    .game-cards {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 40px;
    }
    .game-card {
      background: rgba(0,0,0,0.5);
      border: 3px solid #ffd700;
      border-radius: 16px;
      padding: 30px;
      cursor: pointer;
      transition: all 0.3s;
      width: 200px;
    }
    .game-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .game-card.selected {
      border-color: #00d9ff;
      background: rgba(0,217,255,0.2);
    }
    .game-card .icon { font-size: 3rem; margin-bottom: 10px; }
    .game-card .name { font-size: 1.3rem; font-weight: bold; color: #ffd700; }
    .game-card .desc { font-size: 0.85rem; color: #ccc; margin-top: 8px; }
    .game-card .coming { 
      font-size: 0.75rem; 
      color: #ef4444; 
      margin-top: 10px;
    }
    
    #welcomeScreen input {
      padding: 15px 20px;
      border-radius: 10px;
      border: 2px solid #ffd700;
      font-size: 1.1rem;
      width: 250px;
      background: rgba(255,255,255,0.95);
    }
    #welcomeScreen button {
      padding: 15px 30px;
      border-radius: 10px;
      border: none;
      font-size: 1.1rem;
      font-weight: bold;
      background: #00d9ff;
      color: #000;
      cursor: pointer;
      margin-left: 10px;
    }
    
    /* Game Screen */
    #gameScreen { display: none; }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,0.4);
      padding: 12px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .header .title { font-size: 1.3rem; color: #ffd700; font-weight: bold; }
    .header .info { display: flex; gap: 20px; align-items: center; }
    .header .name { color: #00d9ff; }
    .header .balance { color: #22c55e; font-weight: bold; }
    .header button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      background: #6b7280;
      color: white;
      cursor: pointer;
    }
    
    .table {
      background: linear-gradient(180deg, #1e3a5f 0%, #0d2137 100%);
      border-radius: 20px;
      padding: 30px;
      margin: 20px 0;
      border: 4px solid #ffd700;
      min-height: 350px;
    }
    
    .dealer-area { text-align: center; margin-bottom: 30px; }
    .dealer-area .label { font-size: 1.1rem; color: #ffd700; margin-bottom: 15px; }
    .dealer-area .cards { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .dealer-area .score { font-size: 1.5rem; font-weight: bold; margin-top: 10px; }
    
    .player-area { text-align: center; }
    .player-area .label { font-size: 1.1rem; color: #00d9ff; margin-bottom: 15px; }
    .player-area .cards { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .player-area .score { font-size: 1.5rem; font-weight: bold; margin-top: 10px; }
    .player-area .bet-info { font-size: 1rem; color: #f59e0b; margin-top: 5px; }
    
    .card {
      width: 70px;
      height: 100px;
      background: white;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.3rem;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.5);
    }
    .card.red { color: #dc2626; }
    .card.black { color: #1f2937; }
    .card.back {
      background: linear-gradient(135deg, #7c3aed 0%, #a855f7 50%, #7c3aed 100%);
      border: 2px solid #e9d5ff;
    }
    .card .suit { font-size: 1.8rem; }
    .card .value { font-size: 1.1rem; }
    
    .controls {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 25px;
      flex-wrap: wrap;
    }
    .controls button {
      padding: 12px 25px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      font-weight: bold;
    }
    .controls button:hover { transform: translateY(-2px); }
    .btn-hit { background: #22c55e; color: white; }
    .btn-stand { background: #ef4444; color: white; }
    .btn-double { background: #f59e0b; color: #000; }
    .btn-new { background: #00d9ff; color: #000; }
    
    .bet-section {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
    }
    .bet-section input {
      padding: 10px 15px;
      border-radius: 6px;
      border: 2px solid #ffd700;
      font-size: 1rem;
      width: 80px;
      text-align: center;
    }
    .bet-section button {
      padding: 10px 20px;
      border-radius: 6px;
      border: none;
      font-size: 0.9rem;
      font-weight: bold;
      background: #ffd700;
      color: #000;
      cursor: pointer;
      margin-left: 8px;
    }
    
    .message {
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 15px 0;
      padding: 12px;
      border-radius: 8px;
    }
    .message.win { background: rgba(34,197,94,0.3); color: #22c55e; }
    .message.lose { background: rgba(239,68,68,0.3); color: #ef4444; }
    .message.push { background: rgba(255,255,255,0.2); }
    .message.blackjack { background: rgba(255,215,0,0.3); color: #ffd700; }
    .message.waiting { background: rgba(255,255,255,0.1); font-size: 1rem; }
    
    .other-players {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    .other-player {
      background: rgba(0,0,0,0.4);
      padding: 8px 12px;
      border-radius: 8px;
      text-align: center;
      min-width: 80px;
    }
    .other-player .name { font-size: 0.8rem; color: #aaa; }
    .other-player .cards { display: flex; gap: 3px; justify-content: center; margin: 5px 0; }
    .other-player .card { width: 30px; height: 42px; font-size: 0.6rem; }
    .other-player.active { border: 2px solid #00d9ff; }
    
    .admin-panel {
      background: rgba(0,0,0,0.5);
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
    }
    .admin-panel input {
      padding: 6px 10px;
      border-radius: 4px;
      border: 1px solid #ffd700;
      background: white;
      width: 80px;
    }
    .admin-panel button {
      padding: 6px 12px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      background: #ffd700;
      color: #000;
      margin-left: 5px;
    }
    
    .fortune {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      background: rgba(0,0,0,0.7);
      border-radius: 20px;
      color: #ffd700;
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- Welcome Screen -->
    <div id="welcomeScreen">
      <h1>üê≤ Êñ∞Âπ¥Âø´‰πê üßß</h1>
      <p class="subtitle">Choose Your Game</p>
      
      <div class="game-cards">
        <div class="game-card selected" onclick="selectGame('blackjack')">
          <div class="icon">üÉè</div>
          <div class="name">21ÁÇπ</div>
          <div class="desc">Classic Blackjack</div>
        </div>
        <div class="game-card" onclick="selectGame('poker')">
          <div class="icon">üÉ¥</div>
          <div class="name">Âæ∑Â∑ûÊâëÂÖã</div>
          <div class="coming">Coming Soon</div>
        </div>
      </div>
      
      <input type="text" id="playerName" placeholder="Enter your name" />
      <button onclick="joinGame()">üéÆ Play Now</button>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen">
      <div class="header">
        <button onclick="goBack()">‚Üê Back</button>
        <div class="title" id="gameTitle">üÉè 21ÁÇπ Blackjack</div>
        <div class="info">
          <span class="name" id="playerNameDisplay"></span>
          <span class="balance">üí∞ <span id="balanceDisplay">100</span></span>
        </div>
      </div>
      
      <div class="table">
        <!-- Dealer -->
        <div class="dealer-area">
          <div class="label">üé∞ Dealer</div>
          <div class="cards" id="dealerCards"></div>
          <div class="score" id="dealerScore"></div>
        </div>
        
        <!-- Message -->
        <div class="message" id="gameMessage"></div>
        
        <!-- Player -->
        <div class="player-area">
          <div class="label">üë§ You</div>
          <div class="cards" id="playerCards"></div>
          <div class="score" id="playerScore"></div>
          <div class="bet-info" id="betInfo"></div>
        </div>
        
        <!-- Betting -->
        <div class="bet-section" id="betSection">
          <input type="number" id="betAmount" placeholder="Bet" value="10" min="1" />
          <button onclick="placeBet()">üí∞ Place Bet</button>
        </div>
        
        <!-- Controls -->
        <div class="controls" id="gameControls" style="display:none;">
          <button class="btn-hit" onclick="hit()">üñêÔ∏è Hit</button>
          <button class="btn-stand" onclick="stand()">‚úã Stand</button>
          <button class="btn-double" onclick="doubleDown()">‚úåÔ∏è Double</button>
        </div>
        
        <!-- Next Round -->
        <div class="controls" id="nextRoundControls" style="display:none;">
          <button class="btn-new" onclick="nextRound()">üéÆ Next Round</button>
        </div>
        
        <!-- Other Players -->
        <div class="other-players" id="otherPlayers"></div>
      </div>
      
      <!-- Admin -->
      <div class="admin-panel">
        üëë <input type="password" id="adminPassword" placeholder="Admin" />
        <button onclick="setAdmin()">Set</button>
        <button onclick="resetAll()">Reset All</button>
      </div>
    </div>
  </div>
  
  <div class="fortune">üßß ÊÅ≠ÂñúÂèëË¥¢</div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    let selectedGame = 'blackjack';
    let myId = null;
    let myBalance = 100;
    
    function selectGame(game) {
      selectedGame = game;
      document.querySelectorAll('.game-card').forEach(c => c.classList.remove('selected'));
      document.querySelector(`[onclick="selectGame('${game}')"]`).classList.add('selected');
    }
    
    function joinGame() {
      const name = document.getElementById('playerName').value.trim();
      if (!name) { alert('Enter your name'); return; }
      
      socket.emit('joinGame', { name, game: selectedGame });
      
      document.getElementById('welcomeScreen').style.display = 'none';
      document.getElementById('gameScreen').style.display = 'block';
      document.getElementById('playerNameDisplay').textContent = name;
    }
    
    function goBack() {
      if (confirm('Leave game?')) {
        location.reload();
      }
    }
    
    function placeBet() {
      const bet = parseInt(document.getElementById('betAmount').value);
      if (isNaN(bet) || bet < 1) { alert('Invalid bet'); return; }
      socket.emit('placeBet', { bet });
    }
    
    function hit() { socket.emit('hit'); }
    function stand() { socket.emit('stand'); }
    function doubleDown() { socket.emit('double'); }
    function nextRound() { socket.emit('nextRound'); }
    
    function setAdmin() {
      const pw = document.getElementById('adminPassword').value;
      socket.emit('setAdmin', { password: pw });
    }
    function resetAll() {
      if (confirm('Reset all players to 100?')) {
        socket.emit('adminReset');
      }
    }
    
    const socket = io();
    socket.on('connect', () => { myId = socket.id; });
    
    socket.on('balanceUpdate', (balance) => {
      myBalance = balance;
      document.getElementById('balanceDisplay').textContent = balance;
    });
    
    socket.on('gameState', (state) => { render(state); });
    socket.on('error', (msg) => { alert(msg); });
    
    function render(state) {
      // Dealer
      const dealerHtml = state.dealerCards.map((c, i) => {
        if (i === 0 && state.phase !== 'settled' && state.phase !== 'dealerTurn') {
          return '<div class="card back"></div>';
        }
        return renderCard(c);
      }).join('');
      document.getElementById('dealerCards').innerHTML = dealerHtml;
      
      const dealerScore = state.phase === 'settled' || state.phase === 'dealerTurn' 
        ? state.dealerScore : '?';
      document.getElementById('dealerScore').textContent = dealerScore !== '?' 
        ? `Score: ${dealerScore}` : '';
      
      // My player
      const me = state.players[myId];
      if (me) {
        myBalance = me.balance;
        document.getElementById('balanceDisplay').textContent = me.balance;
        
        const playerHtml = me.cards.map(c => renderCard(c)).join('');
        document.getElementById('playerCards').innerHTML = playerHtml;
        document.getElementById('playerScore').textContent = me.cards.length > 0 
          ? `Score: ${me.score}` : '';
        
        document.getElementById('betInfo').textContent = me.bet > 0 ? `Bet: ${me.bet}` : '';
      }
      
      // Sections
      const betSection = document.getElementById('betSection');
      const controls = document.getElementById('gameControls');
      const nextControls = document.getElementById('nextRoundControls');
      const msg = document.getElementById('gameMessage');
      
      msg.style.display = 'none';
      
      if (state.phase === 'betting') {
        betSection.style.display = 'block';
        controls.style.display = 'none';
        nextControls.style.display = 'none';
        
        if (me && me.bet > 0) {
          msg.style.display = 'block';
          msg.className = 'message waiting';
          msg.textContent = 'Waiting for other players...';
        }
      } else if (state.phase === 'playerTurn' || state.phase === 'dealing') {
        betSection.style.display = 'none';
        controls.style.display = 'flex';
        nextControls.style.display = 'none';
        
        const canDouble = me && me.cards.length === 2 && me.balance >= (me.bet || 0);
        controls.querySelector('.btn-double').disabled = !canDouble;
        
        if (state.currentPlayerId === myId) {
          msg.style.display = 'block';
          msg.className = 'message waiting';
          msg.textContent = "üéØ Your turn!";
        }
      } else if (state.phase === 'settled') {
        betSection.style.display = 'none';
        controls.style.display = 'none';
        nextControls.style.display = 'flex';
        
        if (me && me.result) {
          msg.style.display = 'block';
          if (me.result === 'blackjack') {
            msg.className = 'message blackjack';
            msg.textContent = 'üéâ BLACKJACK!';
          } else if (me.result === 'win') {
            msg.className = 'message win';
            msg.textContent = 'üéä You Win!';
          } else if (me.result === 'lose') {
            msg.className = 'message lose';
            msg.textContent = 'üíÄ Dealer Wins';
          } else if (me.result === 'push') {
            msg.className = 'message push';
            msg.textContent = '‚öñÔ∏è Push';
          } else if (me.result === 'bust') {
            msg.className = 'message lose';
            msg.textContent = 'üí• BUST!';
          }
        }
      }
      
      // Other players
      let html = '';
      for (const id in state.players) {
        if (id === myId) continue;
        const p = state.players[id];
        const isActive = id === state.currentPlayerId;
        
        html += `<div class="other-player ${isActive ? 'active' : ''}">`;
        html += `<div class="name">${p.name}</div>`;
        
        if (p.cards.length > 0) {
          html += '<div class="cards">' + p.cards.map(c => renderCard(c)).join('') + '</div>';
          html += `<div class="score">${p.score}</div>`;
        } else {
          html += '<div class="cards"><span style="color:#666;font-size:0.6rem">Waiting...</span></div>';
        }
        html += '</div>';
      }
      document.getElementById('otherPlayers').innerHTML = html;
    }
    
    function renderCard(card) {
      const color = (card.suit === '‚ô•' || card.suit === '‚ô¶') ? 'red' : 'black';
      return `<div class="card ${color}">
        <div class="value">${card.value}</div>
        <div class="suit">${card.suit}</div>
      </div>`;
    }
  </script>
</body>
</html>
